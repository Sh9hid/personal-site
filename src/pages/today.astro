---
import TerminalLayout from '../layouts/TerminalLayout.astro';
import fs from 'node:fs';
import path from 'node:path';

const today = new Date();
const todayStr = today.toISOString().split('T')[0];
const todayFile = `${todayStr}.md`;

const contentDir = path.join(process.cwd(), 'src', 'content', 'publish');
const todayPath = path.join(contentDir, 'daily', todayFile);

let todayContent = null;
let exists = false;

if (fs.existsSync(todayPath)) {
  exists = true;
  const raw = fs.readFileSync(todayPath, 'utf-8');
  const match = raw.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
  if (match) {
    const fm: Record<string, string> = {};
    match[1].split('\n').forEach(line => {
      const [key, ...rest] = line.split(':');
      if (key && rest.length) {
        fm[key.trim()] = rest.join(':').trim().replace(/^["']|["']$/g, '');
      }
    });
    todayContent = {
      title: fm.title || 'Today',
      date: fm.date || todayStr,
      content: match[2].trim()
    };
  }
}
---

<TerminalLayout title="today">
  <div class="pane" style="grid-column: 1 / -1; grid-row: 1 / -1; overflow: auto;">
    <div class="pane-header">today // {todayStr}</div>
    
    {exists && todayContent ? (
      <article>
        <h1 class="text-xl mb-4">{todayContent.title}</h1>
        <div class="content">
          {todayContent.content.split('\n').map(line => (
            <p class="mb-2">{line}</p>
          ))}
        </div>
      </article>
    ) : (
      <div class="text-meta">no entry for today</div>
    )}
  </div>
</TerminalLayout>
